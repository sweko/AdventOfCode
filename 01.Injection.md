# Инјекција на код

## Метрики на ризикот

### Искористливост: Лесна

Скоро секој извор на податоци може да биде вектор на инјекција, доколку не е соодветно санитиран. Тоа вклучува околински променливи, параметри, интерни и екстерни веб-сервиси, како и податоци директно внесени од корисниците. Инјекциски пропусти се појавуваат кога напаѓачите можат директно да пратат податоци кон некој интерпретер, без тие податоци да бидат санитирани.

### Честост: Просечна

Инјекциските пропусти се многу чести, особено во наследен код. Типични места на кои може да се најдат е во SQL, LDAP, XPath или NoSQL прашалници, автоматизирани OS команди, XML парсери, SMTP заглавија, или несигурно изработени јазици специфични за домен. Во принцип, било кое место каде што апликацијата може да прими неверифициран внес од корисничка страна може да биде вектор за овој напад.

### Лесност за пронаоѓање: Лесно

Инјекциските пропусти се лесни за пронаоѓање со помош на автоматска или мануелна статичка анализа на кодот. Исто така, може да се користат и специфички алатки за динамичка анализа на кодот.

### Техничко влијание: Големо

Инјекција на код може да предизвика губење на податоци, објавување на податоци на неавторизирани агенти, одбивање на пристап и друго. Може да биде почетен вектор кој би довел до губење на контрола врз системот.

## Дали апликацијата е ранлива:

Една аплицакција е ранлива на инјекциски напад доколку:

- Податоците превземени од корисниците не се валидираат, филтрираат или санитираат.
- Се користат интерпретери без контексно-зависно санитирање на податоците или се користат непараметризирани повици
- Внесените податоци се користат директно со спојување, така што командите содржат истовремено и структура и податоци во динамички прашалници, команди или процедури.

Најчести видови на инјекција се во SQL и NoSQL бази на податоци, OS команди, LDAP прашалници и слично. Концептот е идентичен кај сите интерпретери, и се состои од интерпретација на податоците внесени од корисникот не како податоци, туку како структурна наредба.
Најдобар начин за одбрана од овој тип на ранливост е внимателно прегледување на кодот, придружено со автоматско тестирање на сите влезни параметри, заглавија, URL параметри и колачиња. Организациите можат да вклучат алатки за SAST и DAST во нивниот CI/CD pipeline кои би идентификувале инјекциски пропусти пред да стигне апликацијата во продукциска околина.

## Како да се заштитиме:
	
За превенција од инјекција потребно е во секој момент податоците да бидат разделени од структурата на прашалниците и командите.
- Преферирана опција е користење на познато безбедно API, кое не користи интерпретер, или пак користи автоматско параметризирање, како што се ORM алатките за работа со SQL бази на податоци. Мора да се забележи дека дури и користење на вакви алатки, доколку имаме складирани процедури кои динамички генерираат и извршуваат непараметризиран код, сепак може да се случе секундарна инјекција.
- Користење на позитивни, "бели" листи на валидни вредности. Ова е техника со ограничена корисност бидејќи многу апликации имаат потреба од внес на специјални карактери, или слободен внес од страна на корисникот.
- За преостанатите динамички прашалници, специјалните карактери мора да бидат санитирани користејќи ја специфичната синтакса на интерпретерот. 
- Користење на изрази (како LIMIT во SQL) кои го контролираат волуменот на податоци што може да биде пристапен, за да се заштитеме од масовно откривање на податоци, дури и доколку се случи инјекција.
	
Еден познат исклучок од овие правила се апликациите за репортирање, бидејќи во нив чест случај е потреба од внес од структурни елементи како влезен податок.